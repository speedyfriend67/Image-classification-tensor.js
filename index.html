<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Classification with TensorFlow.js</title>
<style>
  #imageElement {
    max-width: 100%;
    max-height: 300px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>
<h1>Image Classification with TensorFlow.js</h1>
<p>Select an image to classify:</p>
<input type="file" id="imageFile" accept="image/*">
<img id="imageElement" src="#" alt="Selected Image">
<div id="predictionResults"></div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@3.8.0/dist/tf-converter.min.js"></script>
<script>
  async function loadModel(modelUrl) {
    const model = await tf.loadGraphModel(modelUrl);
    return model;
  }

  async function classifyImage(imageElement, model) {
    const tfImg = tf.browser.fromPixels(imageElement).resizeNearestNeighbor([224, 224]).toFloat().expandDims();
    const predictions = await model.predict(tfImg).data();
    return predictions;
  }

  const imageFileInput = document.getElementById('imageFile');
  const predictionResults = document.getElementById('predictionResults');

  imageFileInput.addEventListener('change', async function(event) {
    const file = event.target.files[0];
    const imgElement = document.getElementById('imageElement');
    imgElement.src = URL.createObjectURL(file);

    imgElement.onload = async function() {
      predictionResults.innerHTML = 'Classifying...';
      const modelUrl = 'https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/feature_vector/4/model.json';
      const model = await loadModel(modelUrl);
      const predictions = await classifyImage(imgElement, model);
      displayPredictions(predictions);
    };
  });

  function displayPredictions(predictions) {
    const topClasses = getTopPredictedClasses(predictions);
    predictionResults.innerHTML = '';
    topClasses.forEach((result) => {
      const { className, probability } = result;
      const listItem = document.createElement('li');
      listItem.textContent = `${className}: ${probability.toFixed(4)}`;
      predictionResults.appendChild(listItem);
    });
  }

  function getTopPredictedClasses(predictions, topK = 5) {
    const sortedPredictions = Array.from(predictions)
      .map((prob, index) => ({ probability: prob, className: IMAGENET_CLASSES[index] }))
      .sort((a, b) => b.probability - a.probability)
      .slice(0, topK);
    return sortedPredictions;
  }

  const IMAGENET_CLASSES = {
    0: 'tench, Tinca tinca',
    1: 'goldfish, Carassius auratus',
    2: 'great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias',
    // Add more ImageNet classes here...
  };
</script>
</body>
</html>
